"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Address=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(){$("[data-tab]").on("click",toggleTabs),$(".checkout-address__item").on("click",function(e){var t=$(this).data("value");$("#address_id").val(t),$(this).siblings().removeClass("is-active"),$(this).addClass("is-active")})}}]),e}();_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var AutocompleteAnywhere=function(){function e(t,r){_classCallCheck(this,e);var n=this;return this.element=t,this.el=$(t),this.options=r||{},this.options.delay=this.options.delay||150,this.source=this.options.source||null,!!this.source&&(this.sourceData=[],$(this.source).each(function(e,t){n.sourceData.push({item:t,text:$(t).text()})}),!!this.sourceData&&(this.el.on("input",function(e){e.preventDefault(),n.onInput()}),this.hideCallback=this.options.hideCallback||function(){},this.showCallback=this.options.showCallback||function(){},void(this.timeouts={})))}return _createClass(e,[{key:"onInput",value:function(){var e=this,t=this.el.val();clearTimeout(this.timeouts.input),this.timeouts.input=setTimeout(function(){e.onChange(t)},this.options.delay)}},{key:"onChange",value:function(e){var t=this,r=e.toLowerCase();this.sourceData.map(function(n,o){0!==e.length&&-1===n.text.toLowerCase().indexOf(r)?($(n.item).hide(),"function"==typeof t.hideCallback&&t.hideCallback(n.item)):($(n.item).show(),"function"==typeof t.showCallback&&t.showCallback(n.item))})}},{key:"destroy",value:function(){this.el.off("input"),delete this.sourceData}}]),e}();!function(e){jQuery.fn.autocompleteAnywhere=function(t){return this.each(function(){var r=e(this),n=r.data("autocompleteAnywhere");n&&n.destroy(),n=new AutocompleteAnywhere(this,t),r.data("autocompleteAnywhere",n)})}}($);_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Checkout=function(){function e(t){_classCallCheck(this,e),this.options=t||{},this.options.links=this.options.links||{},this.options.language=this.options.language||{}}return _createClass(e,[{key:"alert",value:function(e,t){$(".overlay").hide(),window.Neos.alert(e,t)}},{key:"init",value:function(){var e=this;$.ajax({url:e.options.links.step1,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(e){$(".checkout-content").html(e),$(".checkout-content").show(),$(".overlay").hide()},error:function(t,r,n){e.alert(e.options.language.error,"error")}}),$("#next-step").on("click",function(){switch($(this).attr("act")){case"step-2":e.nextStep2();break;case"step-3":e.nextStep3();break;case"step-4":e.nextStep4();break;case"confirm":e.confirm()}}),$("#prev-step").on("click",function(){switch($(this).attr("act")){case"step-1":e.prevStep1();break;case"step-2":e.prevStep2();break;case"step-3":e.prevStep3()}})}},{key:"nextStep2",value:function(){var e=this;return $("#telephone").inputmask("isComplete")?""==$("#email").val()?($("input[name='email']").after($("<p></p>").addClass("error").text("Заполните данное поле!")),!1):void $.ajax({url:e.options.links.validate_step2,type:"POST",data:$("#checkout-form").serialize(),dataType:"json",beforeSend:function(){$(".overlay").show(),$("input").removeClass("error")},complete:function(){$(".wait").remove()},success:function(t){if($(".warning, .error").remove(),!0===e._handleErrors(1,t))return!1;$.ajax({url:e.options.links.step2,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(t){$(".checkout-content").html(t),$(".overlay").hide(),$("#prev-step").addClass("active"),$(".checkout-steps__item").eq(1).addClass("active"),$("#next-step").attr("act","step-3"),$("#prev-step").attr("act","step-1"),$("span.info").text("Нажмите, что бы перейти на страницу выбора способа доставки"),$(".checkout-title").text("Оформление заказа: Шаг 2 из "+e.options.max_step)},error:function(t,r,n){e.alert(e.options.language.error,"error")}})},error:function(t,r,n){e.alert(e.options.language.error,"error")}}):($("input[name='telephone']").after($("<p></p>").addClass("error").text("Заполните данное поле!")),!1)}},{key:"nextStep3",value:function(){var e=this;$.ajax({url:e.options.links.validate_step3,type:"post",data:$(".tab--is-active form").serialize(),dataType:"json",beforeSend:function(){$(".overlay").show(),$("input").removeClass("error")},complete:function(){$(".wait").remove()},success:function(t){if($(".warning, .error").remove(),!0===e._handleErrors(2,t))return!1;$.ajax({url:e.options.links.step3,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(t){$(".checkout-content").html(t),$(".checkout-steps__item").eq(2).addClass("active");var r={};2==e.options.customer_group?(r.act="step-4",r.text="Продолжить",r.info="Нажмите, что бы перейти на страницу подтверждения заказа"):(r.act="confirm",r.text="Оформить",r.info="Нажимая кнопку «Оформить», Вы даёте согласие на хранение и обработку Ваших персональных данных"),$("#next-step").attr("act",r.act),$("#next-step").text(r.text),$("span.info").text(r.info),$("#prev-step").attr("act","step-2"),$(".checkout-title").text("Оформление заказа: Шаг 3 из "+e.options.max_step+" - Выберите способ оплаты и доставки"),$(".overlay").hide()},error:function(t,r,n){e.alert(e.options.language.error,"error")}})}})}},{key:"nextStep4",value:function(){var e=this,t=$("input:radio[name='delivery-way']:checked").val();if(void 0===t)return e.alert("Выберите способ доставки","warning"),!1;for(var r={},n=$("#checkout-form").serializeArray(),o=0;o<n.length;o++)""!=n[o].value&&(r[n[o].name]=n[o].value);r.deliverytype=t,$.ajax({url:e.options.links.validate_step4,type:"post",data:r,dataType:"json",beforeSend:function(){$(".overlay").show(),$("input").removeClass("error")},complete:function(){$(".wait").remove()},success:function(t){if($(".warning, .error").remove(),!0===e._handleErrors(3,t))return!1;$.ajax({url:e.options.links.confirm,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(t){$(".checkout-content").html(t),$(".checkout-steps__item").eq(3).addClass("active");var r={act:"confirm",text:"Оформить",info:"Нажимая кнопку «Оформить», Вы даёте согласие на хранение и обработку Ваших персональных данных"};$("#next-step").attr("act",r.act),$("#next-step").text(r.text),$("span.info").text(r.info),$("#prev-step").attr("act","step-3"),$(".checkout-title").text("Оформление заказа: Шаг 4 из "+e.options.max_step+" - Выберите способ оплаты и доставки"),$(".overlay").hide()},error:function(t,r,n){e.alert(e.options.language.error,"error")}})},error:function(t,r,n){e.alert(e.options.language.error,"error")}})}},{key:"confirm",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;if(2==e.options.customer_group||3==e.options.customer_group||4==e.options.customer_group){var t=function(){$.ajax({type:"get",url:e.options.links.final_confirm,dataType:"JSON",success:function(t){if(!t||0==t.success)return e.alert(e.options.language.error,"error"),!1;1==t.success?$.ajax({url:"index.php?route=payment/cod/confirm",success:function(){window.location=e.options.links.success}}):t.redirect&&(window.location=t.redirect)},error:function(){e.alert(e.options.language.error,"error")}})};if($(".check_photo").length>0)t();else 1==confirm("Вы не прикрепили фото чека. Завершить оформление заказа?")&&t();return!1}var r=$("input:radio[name='delivery-way']:checked").val();if(void 0===r)return e.alert("Выберите способ доставки","warning"),!1;$.ajax({url:e.options.links.confirm,data:{deliverytype:r},beforeSend:function(){$(".overlay").show()},success:function(t){try{var r=JSON.parse(t);null!=r.redirect&&(window.location=r.redirect)}catch(t){window.location=e.options.links.success}setTimeout(function(){$(".overlay").hide()},500)},error:function(t,r,n){e.alert(e.options.language.error,"error")}})})},{key:"prevStep1",value:function(){var e=this;$.ajax({url:e.options.links.step1,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(t){$(".checkout-content").html(t),$(".checkout-title").text("Оформление заказа: Шаг 1 из "+e.options.max_step),$("#prev-step").removeClass("active").attr("act","step-0"),$(".checkout-steps__item").eq(1).removeClass("active"),$("#next-step").attr("act","step-2"),$(".overlay").hide(),$("span.info").text("Нажмите, чтобы перейти на страницу ввода адреса доставки")},error:function(t,r,n){e.alert(e.options.language.error,"error")}})}},{key:"prevStep2",value:function(){var e=this;$.ajax({url:e.options.links.step2,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(t){$(".checkout-content").html(t),$(".overlay").hide(),$("#prev-step").addClass("active"),$(".checkout-steps__item").eq(2).removeClass("active"),$("#next-step").attr("act","step-3"),$("#next-step").text("Продолжить"),$("#prev-step").attr("act","step-1"),$("span.info").text("Нажмите, что бы перейти на страницу выбора способа доставки"),$(".checkout-title").text("Оформление заказа: Шаг 2 из "+e.options.max_step)},error:function(t,r,n){e.alert(e.options.language.error,"error")}})}},{key:"prevStep3",value:function(){var e=this;$.ajax({url:e.options.links.step3,dataType:"html",beforeSend:function(){$(".overlay").show()},success:function(t){$(".checkout-content").html(t),$(".checkout-steps__item").eq(3).removeClass("active");var r={};2==e.options.customer_group?(r.act="step-4",r.text="Продолжить",r.info="Нажмите, что бы перейти на страницу подтверждения заказа"):(r.act="confirm",r.text="Оформить",r.info="Нажимая кнопку «Оформить», Вы даёте согласие на хранение и обработку Ваших персональных данных"),$("#next-step").attr("act",r.act),$("#next-step").text(r.text),$("span.info").text(r.info),$("#prev-step").attr("act","step-2"),$(".checkout-title").text("Оформление заказа: Шаг 3 из "+e.options.max_step+" - Выберите способ оплаты и доставки"),$(".overlay").hide()},error:function(t,r,n){e.alert(e.options.language.error,"error")}})}},{key:"_handleErrors",value:function(e,t){var r=this;if(t.redirect)return window.location=t.redirect,!0;if(t.error){switch(t.error.warning?r.alert(t.error.warning,"warning"):$("html,body").animate({scrollTop:$(".checkout-body").offset().top},1500),$(".overlay").hide(),r._showErrors(t.error),e){case 1:t.error.warning&&($(".checkout-content").prepend('<div class="warning" style="display: none;">'+t.error.warning+'<img src="catalog/view/theme/default/image/close.png" alt="" class="close" /></div>'),$(".warning").fadeIn("slow")),void 0!==t.error.yrregistered&&$.ajax({url:"/login/?ajax=1",success:function(e){$("#notification").before('<div class="backg_notif smooth"></div>').html('<div class="success modal-beautify"><img src="catalog/view/theme/default/image/close.png" alt="" class="close" />'+e+"</div>"),$("#notification").find("h1").text(t.error.yrregistered),$("#notification").find("#email").val(t.email)}});break;case 2:if(t.error.city_not_found){$("input[name='np']").after($("<p></p>").addClass("error").text(t.error.city_not_found));var n=$("#np").val();$.ajax({url:"index.php?route=checkout/payment_address/address",dataType:"json",data:{q:n,thing:"np1"},success:function(e){if($(".warning, .error").remove(),e.error&&e.error.city_not_found)return $("input[name='np']").after($("<p></p>").addClass("error").text(e.error.city_not_found)),!1;if("string"==typeof e.error)return r.alert(e.error),!1;var t=e.items;if(0==t.length)return r.alert("К сожалению указанный вами адрес не распознан, попробуйте указать адрес иначе или напишите нам в чат"),!1;var n="<ul>";t.forEach(function(t,r,o){n+='<li data-cachehash="'+e.cachehash+'">'+t+"</li>"}),n+="</ul>",$("#overlayData").html(n),$(".overlay-data").show(),$("#overlayData ul li").on("click",function(){$(".overlay-data").hide();var e=$(this).text(),t=$(this).data("cachehash");$.ajax({url:"index.php?route=checkout/payment_address/address",dataType:"json",data:{q:e,cachehash:t,thing:"np2"},success:function(e){return $(".warning, .error").remove(),e.error&&e.error.city_not_found?($("input[name='np']").after($("<p></p>").addClass("error").text(e.error.city_not_found)),!1):"string"==typeof e.error?(r.alert(e.error),!1):($("#np").val(e.items),$("#is_db").val(e.is_db),void $("#next-step").trigger("click"))}})})}})}}return!0}}},{key:"_showErrors",value:function(e){for(var t in e)$("input[name='"+t+"']").after($("<p></p>").addClass("error").text(e[t]))}}]),e}();function toggleTabs(e){var t,r;if(!e)return!1;"a"==$(this).prop("tagName").toLowerCase()&&e.preventDefault(),t=$($(this).attr("data-tab")),(r=$(this)).siblings("[data-tab]").removeClass("is-active"),r.addClass("is-active"),t.addClass("tab--is-active"),t.siblings(".tab").removeClass("tab--is-active"),r.blur()}function toggleInput(e){var t,r,n;if(!e)return!1;"a"==$(this).prop("tagName").toLowerCase()&&e.preventDefault(),t=$($(this).attr("data-input")),n=$($(this).attr("data-input")+"_label"),r=$(this),t.toggle(),n.toggle(),"none"==t.css("display")?(r.removeClass("is-active"),t.prop("disabled",!0)):(r.addClass("is-active"),t.prop("disabled",!1)),r.blur()}!function(e){jQuery.fn.forceNumeric=function(){return this.each(function(){var t=e(this);t.on("input change",function(e){var r=t.val();r=r.replace(/[^0-9\..]/g,""),t.val(r)})})}}($),window.toggleTabs=toggleTabs,window.toggleInput=toggleInput;_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Shipping=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(){$('input[name="delivery-way"]').on("change",function(){$("#checkout-table-info").LoadingOverlay("show");var e=$(this).val();$("#checkout-table-info").load("/index.php?route=checkoutf/shipping_method&delivery-way="+e+" #checkout-table-info > *",{},function(){$("#checkout-table-info").LoadingOverlay("hide")})})}}]),e}();