<?xml version="1.0" encoding="UTF-8"?>
<modification>
  <id>Вывод количества на складе для опций</id>
  <version>1.0.4</version>
  <vqmver>2.2.1</vqmver>
  <author>mpn2005</author>
  
  
  <file name="catalog/view/theme/default2/template/product/product.tpl">
    <operation>
      <search position="before"><![CDATA[<?php if ($option_value['price']) { ?>]]></search>
      <add>
        <![CDATA[
	
          <?php if ($customer_group_id != 1 and $customer_group_id != "") { if ($option_value['subtract']) {
            if ($option_value['quantity'] > 0){
				if ($option_value['quantity'] > 5)
					echo '(>5)';
					else
					echo '('.$option_value['quantity'].')';
			 }
            else
              echo '<span class="option_quantity option_no_stock"> - '.$text_out_of_stock.'. </span>';            
          }} ?>
        ]]>
      </add>
    </operation>
    <operation>
      <search position="replace"><![CDATA[value="<?php echo $option_value['product_option_value_id']; ?>"]]></search>
      <add><![CDATA[value="<?php echo $option_value['product_option_value_id']; ?>" <?php echo (($option_value['subtract'] && !$option_value['quantity']) ? 'disabled="disabled"' : ''); ?>]]></add>
    </operation>    
  </file>
  
  <file name="catalog/language/english/product/product.php">
    <operation error="skip">
      <search position="after"><![CDATA[<?php]]></search>
      <add>
        <![CDATA[
          $_['text_pcs']       = 'pcs';
          $_['text_out_of_stock'] = 'out of stock';
        ]]>
      </add>
    </operation>
  </file>

  <file name="catalog/language/russian/product/product.php">
    <operation error="skip">
      <search position="after"><![CDATA[<?php]]></search>
      <add>
        <![CDATA[
          $_['text_pcs']       = 'шт';
          $_['text_out_of_stock'] = 'нет на складе';
        ]]>
      </add>
    </operation>
  </file>
  
  
  <file name="catalog/controller/product/product.php">
    <operation>
      <search position="before"><![CDATA[$this->data['text_select']]]></search>
      <add>
        <![CDATA[
          $this->data['text_pcs'] = $this->language->get('text_pcs');
          $this->data['text_out_of_stock'] = $this->language->get('text_out_of_stock');
        ]]>
     </add>
    </operation>
    <operation>
      <search position="after"><![CDATA[$option_value_data[] = array(]]></search>
      <add>
        <![CDATA[
          'subtract' => $option_value['subtract'],
          'quantity' => $option_value['quantity'],
        ]]>
     </add>
    </operation>
    
    <operation>
      <search position="replace"><![CDATA[if (!$option_value['subtract'] || ($option_value['quantity'] > 0)) {]]></search>
      <add><![CDATA[if (true) {]]></add>
    </operation>
  </file>
  
</modification>
